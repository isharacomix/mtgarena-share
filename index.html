<!doctype html>
<html lang="en">
<head>
  <title>Magic Share</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <script src="js/jquery.js"></script>
  <script src="js/base64.js"></script>
  <script src="js/pako.js"></script>
  <script src="js/bootstrap.js"></script>
  <script src="js/cards.js"></script>
  <script src="js/local.js"></script>
  <link rel="stylesheet" href="css/bootstrap.css">
</head>

<body>
<div class="container">
  <div class="row" id='share' style="display: none;">
    <div class="col-12">
      <div>To share a deck or draft, copy and paste it and click the button to get your sharing link. Your sharing link will be extremely long, but most social media sites should use their built-in link shortening to reduce it to a finite number of characters.</div>
      <textarea id="forminput" rows="14" cols="50"></textarea>
      <button onclick="genLink();">Share</button>
      <div id='target'>
      </div>
    </div>
  </div>




  <div class="row"  id='deckcontainer' style="display: none;">
    <div id='deckdata' class="col-12">
    </div>
  </div>

  <div class="row"  id='draftcontainer' style="display: none;">
    <div id='draftdata' class="col-12">
    </div>
  </div>



</div>


</body>
<script>
var localdata = window.location.href.substring(window.location.href.indexOf("#")+1);
var localmedia = deserialize(localdata)
if (!("draft" in localmedia || "deck" in localmedia))
{
  $('#share').show();
}
if ("draft" in localmedia)
{
  $('#draftcontainer').show();
  let data = ""
  let packno = 0
  let pickno = 0
  let last = 0
  for (let pick of localmedia.draft)
  {
    let entry = ""
    if (pick.pack.length > last)
    {
      packno += 1
      pickno = 0
    }
    pickno += 1
    last = pick.pack.length
    entry += "<div>Pack "+packno+", Pick "+pickno+"<ul>"
    for (let card of pick.pack)
    {
      if (card == pick.pick)
      {
        entry += "<li><strong><em>"+card+"</em></strong></li>"
      }
      else {
        entry += "<li>"+card+"</li>"
      }
    }
    entry += "</ul></div>"
    data += entry
  }
  $('#draftdata').html(data);

}
if ('deck' in localmedia)
{
  $('#deckcontainer').show();
  let data = ""
  data += "<div class='card mb-5 mt-5'>"
  data += "<div class='card-header'>"
  data += "Deck"
  data += "</div>"
  data += "<div class='card-body'>"
  data += deckHTML(localmedia.deck)
  data += "</div>"
  data += "</div>"

  data += "<div class='card  mb-5 mt-5 d-none d-lg-block' >"
  data += "<div class='card-header'>"
  data += "Visual Spoiler"
  data += "</div>"
  data += "<div class='card-body'>"
  data += visualHTML(localmedia.deck)
  data += "</div>"
  data += "</div>"
  $('#deckdata').html(data);

}


function genLink(){
  $("#target").html("")
  let data = $("#forminput").val()
  let media = {}
  if (data.includes("\nPlayers:"))
  {
    media = parseDraft(data)
  }
  else
  {
    media = parseDeck(data)
  }
  let dest = serialize(media)
  if (dest != "")
  {
    $("#target").html("<a href='#"+dest+"' target='_blank'>Click</a>")
  }
}
</script>


</html>
